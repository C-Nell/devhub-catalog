schemaVersion: 2.2.2
metadata:
  name: backstage-devspace
components:
  - name: tools
    container:
      image: registry.redhat.io/devspaces/udi-rhel9:3.23
      mountSources: true
      sourceMapping: /projects
      cpuLimit: "2"
      memoryLimit: "3Gi"
      env:
        - name: HOST
          value: "0.0.0.0"
        # - name: NODE_ENV
        #   value: "development"
        # - name: NODE_OPTIONS
        #   value: "--dns-result-order=ipv4first --max-old-space-size=2048"
      endpoints:
        - name: frontend
          targetPort: 3000
          exposure: public
          protocol: http
          secure: true
        - name: backend
          targetPort: 7007
          exposure: public
          protocol: http
          secure: true
projects:
  - name: backstage
    git:
      remotes:
        origin: "https://github.com/c-poteat/devhub-devspace.git"
      checkoutFrom:
        revision: main

commands:
  - id: run-startup
    exec:
      commandLine: node startup-script.js
      component: tools
      workingDir: ${PROJECT_SOURCE}/backstage
      group:
        kind: build

# Add this section to make it run automatically:
events:
  postStart:
    - run-startup

      
