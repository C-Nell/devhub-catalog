apiVersion: v1
kind: ConfigMap
metadata:
  name: rbac-conditional-policies
  namespace: poteatc-dev
  uid: 9fd16196-f299-4600-a23a-bd2a052006b9
  resourceVersion: '5112946948'
  creationTimestamp: '2025-10-22T11:11:00Z'
  managedFields:
    - manager: kubectl-client-side-apply
      operation: Update
      apiVersion: v1
      time: '2025-10-22T11:11:00Z'
      fieldsType: FieldsV1
      fieldsV1:
        'f:data': {}
    - manager: Mozilla
      operation: Update
      apiVersion: v1
      time: '2025-10-31T01:43:51Z'
      fieldsType: FieldsV1
      fieldsV1:
        'f:data':
          'f:rbac-conditional-policies.yaml': {}
        'f:immutable': {}
data:
  rbac-conditional-policies.yaml: |-
    ---
    result: CONDITIONAL
    roleEntityRef: role:default/developer
    pluginId: catalog
    resourceType: catalog-entity
    permissionMapping:
      - read
    conditions:
      anyOf:
        # Condition 1: Entities owned by user
        - rule: IS_ENTITY_OWNER
          resourceType: catalog-entity
          params:
            claims:
              - $ownerRefs
        
        # Condition 2: Public entities
        - rule: HAS_ANNOTATION
          resourceType: catalog-entity
          params:
            annotation: backstage.io/visibility
            value: public
        
        # Condition 3: Group and User kinds
        - rule: IS_ENTITY_KIND
          resourceType: catalog-entity
          params:
            kinds: 
              - Group
              - User
              - Location
binaryData: {}
immutable: false
